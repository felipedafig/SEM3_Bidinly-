@page "/bids"
@layout NoNavLayout
@using shared.DTOs.Bids
@using System.Net.Http.Json
@inject HttpClient Http
@rendermode InteractiveServer

<PageTitle>Bids - Bidinly</PageTitle>

<div class="bids-page">
    <div class="bids-container">
        <h1 class="page-title">All Bids</h1>
        
        @if (isLoading)
        {
            <div class="loading">
                <p>Loading bids...</p>
            </div>
        }
        else if (bids.Any())
        {
            <div class="table-container">
                <table class="bids-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Property</th>
                            <th>Buyer</th>
                            <th>Amount</th>
                            <th>Expiry Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var bid in bids)
                        {
                            <tr>
                                <td>@bid.Id</td>
                                <td>@(bid.PropertyTitle ?? "N/A")</td>
                                <td>@(bid.BuyerUsername ?? "N/A")</td>
                                <td>$@bid.Amount.ToString("N2")</td>
                                <td>@bid.ExpiryDate.ToString("MM/dd/yyyy HH:mm")</td>
                                <td>
                                    <span class="status-badge status-@bid.Status?.ToLower()">@bid.Status</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="no-results">
                <p>No bids found.</p>
            </div>
        }
    </div>
</div>

@code {
    private List<BidDto> bids = new();
    private bool isLoading = true;
    
    protected override async Task OnInitializedAsync()
    {
        await LoadBids();
    }
    
    private async Task LoadBids()
    {
        try
        {
            isLoading = true;
            var response = await Http.GetFromJsonAsync<List<BidDto>>("bids");
            bids = response ?? new List<BidDto>();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading bids: {ex.Message}");
            bids = new List<BidDto>();
        }
        finally
        {
            isLoading = false;
        }
    }
}

