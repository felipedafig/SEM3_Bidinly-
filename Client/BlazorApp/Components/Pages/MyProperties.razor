@page "/my-properties"
@namespace BlazorApp.Components.Pages
@using shared.DTOs.Properties
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Authorization

@attribute [Authorize]
@inject HttpClient Http
@rendermode InteractiveServer

<PageTitle>My Properties - Bidinly</PageTitle>

<div class="properties-background">
    <img src="/assets/images/Table-Background.png" alt="Properties Background" />
    <h1 class="properties-title">My Properties</h1>
</div>

<div class="properties-content">
    <div class="properties-container">
        <table class="properties-table">
            <thead>
                <tr>
                    <th>
                        <div class="table-header-cell">
                            <svg class="header-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 8H17M7 12H17M7 16H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Id</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <svg class="header-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <span>Title</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <span>Address</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <span>Starting Price (DKK)</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <span>Bedrooms</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <span>Bathrooms</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <span>Size (sq ft)</span>
                        </div>
                    </th>
                    <th>
                        <div class="table-header-cell">
                            <svg class="header-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Status</span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                @if (isLoading)
                {
                    <tr>
                        <td colspan="8" class="loading-cell">
                            <p>Loading properties...</p>
                        </td>
                    </tr>
                }
                else if (properties.Any())
                {
                    @foreach (var property in properties)
                    {
                        <tr>
                            <td>@property.Id</td>
                            <td>@(property.Title ?? "N/A")</td>
                            <td>@(property.Address ?? "N/A")</td>
                            <td>@property.StartingPrice.ToString("N2") kr</td>
                            <td>@property.Bedrooms</td>
                            <td>@property.Bathrooms</td>
                            <td>@property.SizeInSquareFeet.ToString("N0")</td>
                            <td>
                                <span class="status-badge status-@(property.Status?.ToLower() ?? "available")">
                                    @(property.Status ?? "Available")
                                </span>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="8" class="empty-cell">
                            <p>No properties found</p>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    private List<PropertyDto> properties = new();
    private bool isLoading = true;
    
    protected override async Task OnInitializedAsync()
    {
        await LoadProperties();
    }
    
    private async Task LoadProperties()
    {
        try
        {
            isLoading = true;
            var response = await Http.GetFromJsonAsync<List<PropertyDto>>("properties");
            properties = response ?? new List<PropertyDto>();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading properties: {ex.Message}");
            properties = new List<PropertyDto>();
        }
        finally
        {
            isLoading = false;
        }
    }
}

