@page "/login"
@namespace BlazorApp.Components.Pages
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@inject AuthenticationStateProvider AuthProvider
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Login - Bidinly</PageTitle>

<div class="login-page">
    <div class="login-container">
        <div class="login-header">
            <h1>Login</h1>
            <p>Enter your credentials to access your account</p>
        </div>
        
        <div class="login-form-container">
            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div class="login-error-message">
                    @errorMessage
                </div>
            }
            
            <div class="login-form-group">
                <label for="login-username">Username</label>
                <input type="text" 
                       id="login-username" 
                       class="login-form-input" 
                       @bind="username" 
                       @bind:event="oninput"
                       placeholder="Enter your username"
                       @onkeydown="HandleKeyDown" />
            </div>
            
            <div class="login-form-group">
                <label for="login-password">Password</label>
                <input type="password" 
                       id="login-password" 
                       class="login-form-input" 
                       @bind="password" 
                       @bind:event="oninput"
                       placeholder="Enter your password"
                       @onkeydown="HandleKeyDown" />
            </div>
            
            <div class="login-form-actions">
                <button class="login-button-cancel" @onclick="HandleCancel">Cancel</button>
                <button class="login-button-confirm" @onclick="HandleLogin" disabled="@(isLoading || string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))">
                    @if (isLoading)
                    {
                        <span>Logging in...</span>
                    }
                    else
                    {
                        <span>Login</span>
                    }
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .login-page {
        width: 100%;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .login-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 450px;
        padding: 2.5rem;
    }

    .login-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .login-header h1 {
        margin: 0 0 0.5rem 0;
        font-size: 2rem;
        font-weight: 700;
        font-family: 'Montserrat', sans-serif;
        color: #333;
    }

    .login-header p {
        margin: 0;
        color: #666;
        font-size: 0.95rem;
    }

    .login-form-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .login-error-message {
        background-color: #fee;
        color: #c33;
        padding: 0.75rem;
        border-radius: 6px;
        font-size: 0.9rem;
        border: 1px solid #fcc;
    }

    .login-form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .login-form-group label {
        font-weight: 600;
        color: #333;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.95rem;
    }

    .login-form-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 1rem;
        font-family: 'Montserrat', sans-serif;
        transition: border-color 0.2s;
        box-sizing: border-box;
    }

    .login-form-input:focus {
        outline: none;
        border-color: #4FC3F7;
    }

    .login-form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        margin-top: 0.5rem;
    }

    .login-button-cancel,
    .login-button-confirm {
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: 600;
        font-family: 'Montserrat', sans-serif;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
    }

    .login-button-cancel {
        background-color: #f0f0f0;
        color: #333;
    }

    .login-button-cancel:hover {
        background-color: #e0e0e0;
    }

    .login-button-confirm {
        background-color: #4FC3F7;
        color: white;
    }

    .login-button-confirm:hover:not(:disabled) {
        background-color: #3db8e0;
    }

    .login-button-confirm:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
</style>

@code {
    private string username = string.Empty;
    private string password = string.Empty;
    private string errorMessage = string.Empty;
    private bool isLoading = false;

    private async Task HandleLogin()
    {
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password) || isLoading)
        {
            return;
        }

        try
        {
            isLoading = true;
            errorMessage = string.Empty;
            StateHasChanged();

            var authProvider = (AuthProvider)AuthProvider;
            await authProvider.Login(username, password);

            // Navigate to dashboard for logged-in users
            Navigation.NavigateTo("/dashboard", forceLoad: false);
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }

    private void HandleCancel()
    {
        Navigation.NavigateTo("/", forceLoad: false);
    }

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !isLoading)
        {
            await HandleLogin();
        }
    }
}

