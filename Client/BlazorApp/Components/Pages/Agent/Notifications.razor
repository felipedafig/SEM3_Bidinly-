@page "/agent-notifications"
@layout NoLayout
@inject NavigationManager Navigation

<PageTitle>Notifications - Bidinly</PageTitle>

<div class="notifications-page">
    
    <button class="back-button" @onclick="GoBack">
        ‚Üê Back
    </button>
    <div class="page-header">
        <h1 class="page-title">Notifications</h1>
    </div>

    <div class="notifications-section">

        @if (!notifications.Any())
        {
            <div class="no-results">No notifications yet.</div>
        }
        else
        {
            <div class="notifications-container">
                @foreach (var n in notifications)
                {
                    var title = GenerateTitle(n.EventType);
                    var message = GenerateMessage(n.EventType, n.PropertyTitle);
                    var type = GenerateType(n.EventType);

                    <div class="notification-card @GetTypeClass(type)">
                        <div class="notification-header">
                            <h3 class="notification-title">@title</h3>
                            <span class="notification-date">@n.Date.ToString("g")</span>
                        </div>

                        <div class="notification-message">@message</div>

                        @if (n.EventType.ToLower() == "newbid")
                        {
                            <button class="notif-action-button"
                                    @onclick="() => GoToBids(n.PropertyId)">
                                View Bids
                            </button>
                        }
                    </div>
                }
            </div>
        }

    </div>
</div>

@code {
    private List<NotificationItem> notifications = new();

    protected override void OnInitialized()
    {
        notifications = new List<NotificationItem>
        {
            new NotificationItem
            {
                EventType = "NewBid",
                PropertyTitle = "Oslo Modern Apartment",
                PropertyId = 14,
                Date = DateTime.Now
            }
        };
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/agent-dashboard");
    }

    private void GoToBids(int propertyId)
    {
        Navigation.NavigateTo($"/property/{propertyId}/bids");
    }

    private string GetTypeClass(string type)
    {
        return type switch
        {
            "success" => "notif-success",
            "error" => "notif-error",
            "warning" => "notif-warning",
            _ => "notif-info"
        };
    }

    private string GenerateTitle(string eventType) =>
        eventType.ToLower() switch
        {
            "newbid" => "New Bid Received",
            "bidexpired" => "Bid Expired",
            _ => "Notification"
        };

    private string GenerateMessage(string eventType, string property) =>
        eventType.ToLower() switch
        {
            "newbid" => $"A new bid has been placed on '{property}'.",
            _ => $"There is an update regarding '{property}'."
        };

    private string GenerateType(string eventType) =>
        eventType.ToLower() switch
        {
            "newbid" => "success",
            "bidexpired" => "error",
            _ => "info"
        };

    public class NotificationItem
    {
        public string EventType { get; set; } = "";
        public string PropertyTitle { get; set; } = "";
        public DateTime Date { get; set; } = DateTime.Now;
        public int PropertyId { get; set; }
    }
}