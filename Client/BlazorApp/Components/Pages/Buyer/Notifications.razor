@page "/buyer-notifications"
@layout NoLayout
@inject NavigationManager Navigation

<PageTitle>Notifications - Bidinly</PageTitle>

<div class="notifications-page">
    
    <button class="back-button" @onclick="GoBack">
        ‚Üê Back
    </button>
    <div class="page-header">
        <h1 class="page-title">Notifications</h1>
    </div>

    <div class="notifications-section">

        @if (notifications == null || !notifications.Any())
        {
            <div class="no-results">No notifications yet.</div>
        }
        else
        {
            <div class="notifications-container">
                @foreach (var n in notifications)
                {
                    var title = GenerateTitle(n.BidStatus);
                    var message = GenerateMessage(n.BidStatus, n.PropertyTitle);
                    var type = GenerateType(n.BidStatus);

                    <div class="notification-card @GetTypeClass(type)">
                        <div class="notification-header">
                            <h3 class="notification-title">@title</h3>
                            <span class="notification-date">@n.Date.ToString("g")</span>
                        </div>

                        <div class="notification-message">@message</div>

                        @if (n.BidStatus.ToLower() == "accepted")
                        {
                            <button class="notif-action-button"
                                    @onclick="() => GoToPayment(n.PropertyId)">
                                Go to Payment
                            </button>
                        }
                        else if (n.BidStatus.ToLower() == "rejected")
                        {
                            <button class="notif-action-button"
                                    @onclick="() => ViewProperty(n.PropertyId)">
                                View Property
                            </button>
                        }
                    </div>
                }
            </div>
        }

    </div>
</div>

@code {
    private List<NotificationItem> notifications = new();

    protected override void OnInitialized()
    {
        // example
        notifications = new List<NotificationItem>
        {
            new NotificationItem {
                BidStatus = "Accepted",
                PropertyTitle = "Modern Apartment in Oslo",
                PropertyId = 2,
                Date = DateTime.Now
            },
            new NotificationItem {
                BidStatus = "Rejected",
                PropertyTitle = "Cozy Bergen House",
                PropertyId = 1,
                Date = DateTime.Now
            }
        };
    }

    private void GoBack() =>
        Navigation.NavigateTo("/buyer-dashboard");

    private void GoToPayment(int propertyId) =>
        Navigation.NavigateTo($"/payment/{propertyId}");

    private void ViewProperty(int propertyId) =>
        Navigation.NavigateTo($"/property/{propertyId}");
    
    private string GetTypeClass(string type) =>
        type switch
        {
            "success" => "notif-success",
            "error" => "notif-error",
            "warning" => "notif-warning",
            _ => "notif-info"
        };

    //autogenerated text
    private string GenerateTitle(string status) =>
        status.ToLower() switch
        {
            "accepted" => "Bid Accepted",
            "rejected" => "Bid Rejected",
            _ => "Bid Update"
        };

    private string GenerateMessage(string status, string property) =>
        status.ToLower() switch
        {
            "accepted" => $"Congratulations! Your bid for '{property}' was accepted.",
            "rejected" => $"Your bid for '{property}' was rejected by the agent.",
            _ => $"Your bid status for '{property}' has been updated."
        };

    private string GenerateType(string status) =>
        status.ToLower() switch
        {
            "accepted" => "success",
            "rejected" => "error",
            _ => "info"
        };

    public class NotificationItem
    {
        public string BidStatus { get; set; } = "";
        public string PropertyTitle { get; set; } = "";
        public DateTime Date { get; set; } = DateTime.Now;
        public int PropertyId { get; set; }
    }
}